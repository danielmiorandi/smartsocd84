\subsection{Incentive Server}
\subsubsection{Functionality and Features}
The Incentive Server analyzes in real-time user interaction and behaviour data within a single application/services  and recommends incentives for these  users. The IS includes learning methods, so that it can adapt its recommendations over time. The IS includes mechanisms for defining  incentive types and messages, for receiving and storing behavioral data, for applying different  algorithms on this behavioral data, for deciding on conditions that requires interventions and for  recommending interventions for the applications that use it. 
\subsubsection{Implementation}
The incentive server is written in python, and uses the django framework. 
\subsubsection{Interfaces, Endpoints and Resources Exposed}
\todo{taken from https://docs.google.com/document/d/1lqdWNfu0RzNBStf5ddGREBBI1ftwA5azfV6bpvOImmY/edit}
We now turn to describe the different APIs supported by the IS. 

Home Page:
URL
/
Method
GET
Parameters

Field
Type
Description








Response


Description
Auto Generated Home Page


Admin Page:
URL
/admin/
Permission
Logged In.
Method
GET
Parameters

Field
Type
Description








Response


Description
Auto Generated  Admin Page

Login:
URL
/login/
Method
POST
Parameters

Field
Type
Description
username
String
The Username.
password
String
The Password.


Usage
POST /login/ HTTP/1.1
Content-Type: application/json
Host: 127.0.0.1:8000
Connection: close
User-Agent: Paw/2.1.1 (Macintosh; OS X/10.10.2) GCDHTTPRequest
Content-Length: 35
    {
        
            "username":"dor",
            "password":"123"
    }
Response
{
 'Token':'ec1db856e230a61cc12ad5040a554c2a312fcee9'
}
Description
Login Action. Used by external applications to obtain access to the intervention server (IS). Must be performed before any other operation access to the IS.






Get All Incentives:
URL
/api/incentive/
Method
GET
Permission
Logged In.
Parameters

Field
Type
Description








Response
{
    "count": 2,
    "next": null,
    "previous": null,
    "results": [
        {
            "owner": "dor",
            "schemeName": "SendEmail",
            "schemeID": 123123,
            "text": "Hello World!",
            "typeID": 1212,
            "typeName": "sending",
            "status": true,
            "ordinal": 21312,
            "tags": [],
            "modeID": 21312,
            "groupIncentive": false,
            "condition": "if the user is older than 21" 
        },
        {
            "owner": "dor",
            "schemeName": "DoNoting",
            "schemeID": 14232,
            "text": "Hello World!",
            "typeID": 1212,
            "typeName": "sending",
            "status": true,
            "ordinal": 21312,
            "tags": [],
            "modeID": 21312,
            "groupIncentive": false,
            "condition": "if the user is older than 21" 
        }
    ]
}
Description
Get All Incentives types from the IS

Add Incentive:
URL
/api/incentive/
Method
POST
Permission
Logged In.
Parameters

Description
Type
Field
The Scheme Name.
String
schemeName
The Scheme ID.
Int
schemeID
The Text of the Incentive.
String
text
The Type ID.
Int
typeID
The Type Name.
String
typeName
The Status.
Boolean
status
The ordinal number.
Int
ordinal
List of Tags for this Incentive (Array of Tags).
Tag[]
tags
The Mode-ID.
Int
modeID
If this a group Incentive.
Boolean
groupIncentive
The Condition for this incentive.
String
condition


Response
HTTP  201 CREATED
Content-Type: application/json 
Vary: Accept
Allow: GET, POST, HEAD, OPTIONS
        {
            "owner": "dor",
            "schemeName": "SendEmail",
            "schemeID": 123123,
            "text": "Hello World!",
            "typeID": 1212,
            "typeName": "sending",
            "status": true,
            "ordinal": 21312,
            "tags": [],
            "modeID": 21312,
            "groupIncentive": false,
            "condition": "if the user is older than 21" 
        }

}
Description
Add an incentive type to the IS

Get Incentive for User:
URL
/getIncUser/
Permission
Logged In.
Method
GET
Parameters

Field
Type
Description
userID
String
The User Id.


Response
{
 "schemeID":"123"
}
Description
Get The Best Incentive for this User. Pull operation by external application to obtain incentive for user


View live interventions:
URL
/dash/pages/dash.html
Method
GET
Parameters

Field
Type
Description








Response


Description
Dash Page: once loaded presents in real time the events received by the IS and the interventions generated by it.

Get interventions by date:
URL
/ask_by_date/
Method
GET
Parameters

Field
Type
Description








Response
json:
{
                "id": id,
                "user_id": str(user_id),
                "created_at": str(created_at),
                "intervention_id": str(intervention_id),
                "preconfigured_id": str(preconfigured_id),
                "cohort_id": str(cohort_id),
                "algo_info": str(algo_info),
                "country_name":str(country_name)
}
Description
get intervention list from the given date.

get interventions by ID:
URL
/ask_by_id/
Method
GET
Parameters

Field
Type
Description
record_id
int
ID of first wanted ID


Response
json or json list:
{
                "id": id,
                "user_id": str(user_id),
                "created_at": str(created_at),
                "intervention_id": str(intervention_id),
                "preconfigured_id": str(preconfigured_id),
                "cohort_id": str(cohort_id),
                "algo_info": str(algo_info),
                "country_name":str(country_name)
}
Description
Intervention or intervention list from the given id.


Posting an Incentive to an External Server 	
In addition to the pull mode, the IS supports sending incentives to an application by calling this application REST API. For this, the IS expects to have the following REST API supported by the external application:

URL
"http://<External Application Server>/users/" + user_id + "/interventions"
Method
POST
Parameters

Field
Type
Description
project
string
project name
intervention_type
string
Type
text_message
string


cohort_id
int


time_duration
int


presentation_duration
int


intervention_channel
string


take_action
string


preconfigured_id
int


experiment_name
string




Response
{
    "cohort_id": 1,
    "created_at": "2015-07-07T10:38:37.703+00:00",
    "details": null,
    "experiment_name": "Zooniverse-MSR-BGU GalaxyZoo Experiment 1",
    "intervention_channel": "web message",
    "intervention_type": "prompt user about talk",
    "preconfigured_id": 1,
    "presentation_duration": 30,
    "project": "galaxy_zoo",
    "state": "active",
    "take_action": "after_next_classification",
    "text_message": "please return",
    "time_duration": 120,
    "updated_at": "2015-07-07T10:38:37.703+00:00",
    "user_id": "17303",
    "id": "559bac2d3031650001140000"
}


Description
Post Incentive to  External Application by calling this REST API 


Listening to Behavioural Data 
The IS is supporting stream delivery of behavioural data from external applications.  For this, it expects the external application to respond to the curl query below with behavioural data in json format. Details are given: 

URL
curl -H "Accept: application/<param>+json" <URL>
Response

Field
Type
Description
user_id
string
mandatory
created_at
string
mandatory
action
string
optional
other fields
string
optional


Description
Listen to behaviour event streams 


\subsubsection{Repository}
The incentive server implementtation can be found at: \url{https://gitlab.com/smartsociety/IncentiveServer}